\documentclass[10pt,a4paper]{article}
\usepackage[latin1]{inputenc}
\usepackage{graphicx,epsfig,palatino}
\usepackage[reqno,centertags]{amsmath}
\usepackage{tikz}
\usepackage{pgfplots}  
\usepackage{fancybox}
\usepackage{amsmath}
\usepackage[margin=1.2in]{geometry}
\setlength{\parindent}{0pt}
\setlength{\parskip}{4mm}
\graphicspath{{./figures/}}
\newcommand{\figuretikz}[3]{\pgfplotsset{width=#1\columnwidth,height=#1\columnwidth,compat=newest,plot coordinates/math parser=false}\input{#1}}
\newcommand{\tm}{\texttrademark}
\newcommand{\minbox}{\fbox{\rule{2mm}{0mm} \rule{0mm}{2mm}} }
\flushbottom

%%%%% My packages
\usepackage{listings}
\usepackage{amstext}
\usepackage{color, xcolor}
%\usepackage{amsmath,mathtools,amssymb,amsfonts,dsfont,cancel} %Math Package
%%%%%

% MATLAB code settings
\lstset{extendedchars=false, % Shutdown no-ASCII compatible
basicstyle=\normalsize\tt, % the size of the fonts that are used for the code
language=Matlab, tabsize=4, numbers=left, numberstyle=\small, stepnumber=1, numbersep=8pt, keywordstyle=\color[rgb]{0,0,1}, commentstyle=\color[rgb]{0.133,0.545,0.133}, stringstyle=\color[rgb]{0.627,0.126,0.941}, backgroundcolor=\color{white}, showspaces=false, showstringspaces=false, showtabs=false, frame=single, captionpos=t, breaklines=true, breakatwhitespace=false, morekeywords={break, case, catch, continue, elseif, else, end, for, function, global, if, otherwise, persistent, return, switch, try, while}, title=\lstname,
mathescape=true,escapechar=? % escape to latex with ?..?  
escapeinside={\%*}{*)}, % if you want to add a comment within your code  
%morestring=[m]', % strings
%columns=fixed, % nice spacing
}

\begin{document}
\begin{titlepage}
%%%%%%%%%%%%%%%%%WRITE NAMES AND PERSONAL IDENTITY NUMBERS WHERE SPECIFIED IN FILE grade_template_to_include_eng.tex%%%%%%%%%%
\input{grade_template}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{titlepage}
\newpage
\pagestyle{plain}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Preparation task}
\begin{itemize}
    \item Derivation of a physical model of the magnetic levitator in state-space form:
    \par From figure in the lab description, we can get:
	\begin{align*}
		m \ddot{z} &= \gamma \dot{z} + E_{r} - F_{ul} - mg \\
		m \ddot{y} &= \gamma \dot{y} - E_{a} + F_{lu} - mg
	\end{align*}
	\par Repulsive magnet force is proportional to $m \vert y - z \vert^{-4}$, and here, constant $C$ is given to represent the proportion:
	\begin{align*}
		F_{ul} &= F_{lu} = C m \frac{1}{(y - z)^{4}}
	\end{align*}
	\par From exercise 2.5, the electromagnetic force can be obtained, where $K$ is a constant:	
	\begin{align*}
		B &= \mu_{0} \frac{N \gamma^{2} I(t)}{2 y^{3}} \\
		E &= \frac{1}{2} A \frac{B^{2}(t)}{\mu_{0}} \\
		E &= \frac{A N^{2} \mu_{0} \gamma^{4}}{8} \frac{I^{2}(t)}{y^{6}(t)} = K m \frac{I^{2}(t)}{y^{6}(t)} \\
		\text{So:} \quad E_{a} &= K m \frac{I^{2}(t)}{y^{6}(t)} \qquad E_{r} = K m \frac{I^{2}(t)}{z^{6}(t)}
	\end{align*}
	\par Then we can obtain state space equations:
	\begin{align*}
		\dot{a} &= \frac{\gamma}{m} \dot{z} + K \frac{I^{2}}{z^{6}} - C \frac{1}{(y - z)^{4}} - g \\
		\dot{b} &= \frac{\gamma}{m} \dot{y} + K \frac{I^{2}}{y^{6}} - C \frac{1}{(y - z)^{4}} - g \\
		\dot{z} &= a \\
		\dot{y} &= b
	\end{align*}
	\item Suggestion for a suitable model order for a linear model:
	\par In stationarity, we have:
	\begin{align*}
		x &= \begin{bmatrix} a \\ b \\ z \\ y \end{bmatrix} \qquad \dot{x} = \begin{bmatrix} \dot{a} \\ \dot{b} \\ \dot{z} \\ \dot{y} \end{bmatrix} = 0 = \begin{bmatrix} f_{1}(a, b, z, y, I_{0}) \\ \vdots \\ f_{4}(a, b, z, y, I_{0}) \end{bmatrix}
	\end{align*}
	\par The linearized system is given by:
	\begin{align*}
		\dot{X} &= A X + B I(t) \\
		A &= \left. \begin{bmatrix} \frac{\partial f_{1}}{\partial a} & \cdots & \frac{\partial f_{1}}{\partial y} \\ \vdots & \ddots & \vdots \\ \frac{\partial f_{4}}{\partial a} & \cdots & \frac{\partial f_{4}}{\partial y} \end{bmatrix} \right|_{a = a^{0}, b = b^{0}, z = z^{0}, y = y^{0}, I = I_{0}} = \begin{bmatrix} \frac{\gamma}{m} & 0 & - \frac{4 C}{(y^{0} - z^{0})^{5}} - \frac{6 K I^{2}}{{z^{0}}^{7}} & \frac{4 C}{(y^{0} - z^{0})^{5}} \\ 0 & \frac{\gamma}{m} & \frac{4 C}{(y^{0} - z^{0})^{5}} & - \frac{4 C}{(y^{0} - z^{0})^{5}} + \frac{6 K I^{2}}{{y^{0}}^{7}} \\ 1 & 0 & 0 & 0 \\ 0 & 1 & 0 & 0 \end{bmatrix} \\ 
		B &= \left. \begin{bmatrix} \frac{\partial f_{1}}{\partial I} \\ \vdots \\ \frac{\partial f_{4}}{\partial I} \end{bmatrix} \right|_{a = a^{0}, b = b^{0}, z = z^{0}, y = y^{0}, I = I_{0}} = \begin{bmatrix} \frac{2 K I}{{z^{0}}^{6}} \\ - \frac{2 K I}{{z^{0}}^{6}} \\ 0 \\ 0 \end{bmatrix}
	\end{align*}
    \item Motivation for suggested model order:
    \par ?????
    \item \textsc{Matlab} codes for the required functions are attached in the page ~\pageref{matlabCode}.
    \item Plot for the spectrum of the binary random signal for the required values of $\alpha$ is shown in Fig.~\ref{fig:binarySpectrum}.
	\begin{figure}[h]
		\footnotesize
		\centering 
		%\def\svgwidth{.8\columnwidth}
		\includegraphics[width=0.8\columnwidth]{binarySpectrum.eps} 
		\caption{Spectrum of binary random signal.}
		\label{fig:binarySpectrum}
	\end{figure}
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Working region}
\begin{itemize}
    \item After the experiment, we choose working region as 1.5A $\sim$ 3.6A.
    \item Motivation for working region:
    \par From Fig.~\ref{fig:workingRegion}, we can see that when $u \in [1.5A, 3.6A]$, the plot have linearity.
    \item Plot for illustrating working region is shown in Fig.~\ref{fig:workingRegion}.
	\begin{figure}[h]
		\footnotesize
		\centering 
		%\def\svgwidth{.8\columnwidth}
		\includegraphics[width=0.8\columnwidth]{findWorkingRegion.png} 
		\caption{Working region.}
		\label{fig:workingRegion}
	\end{figure}
\end{itemize}
%	\begin{figure}[ht]
%		\footnotesize
%		\centering
%		\def\svgwidth{.8\columnwidth}
%		\input{figures/maglev_working.pdf_tex} 
%		\caption{Example of how to choose the working region.}
%		\label{fig:workingRegion}
%	\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Sampling time}
\begin{itemize}
    \item In the experiment, we chose $Ts = 0.002s$ as sampling time.
    \item Motivation for sampling time:
    \par Fig.~\ref{fig:samplingTime} is obtained with the sampling time of $0.001s$, and we can see the rise time is about $13ms$, which means there are about 13 points in one rise time. According to the requirement of ``the sampling time is set to give around four to ten samples per rise time'' in the lab description, we choose $2ms$ as sampling time so that there will be 6 to 7 samples per rise time.
    \item Plot of step responses yielding sampling time:
    \begin{figure}[h]
		\footnotesize
		\centering 
		%\def\svgwidth{.8\columnwidth}
		\includegraphics[width=0.8\columnwidth]{findSamplingTime.png} 
		\caption{Working region.}
		\label{fig:samplingTime}
	\end{figure}
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Input signals}
\begin{itemize}
    \item The binary random signal we choose have the similar output spectrum as the one of the white noises, which can be seen from Fig.~\ref{fig:binarySpectrum} and Fig.~\ref{fig:whiteNoiseSpectrum}.
    \begin{figure}[h]
		\footnotesize
		\centering
		%\def\svgwidth{.8\columnwidth}
		\includegraphics[width=0.8\columnwidth]{whiteNoiseSpectrum.eps} 
		\caption{Working region.}
		\label{fig:whiteNoiseSpectrum}
	\end{figure}
    \item motivation for chosen input signals.
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Estimation and validation data}
\begin{itemize}
    \item Information about the amount of data used for identification and validation:
    \begin{table}[h]
	    \footnotesize
    	\centering
    	\caption{Data used for identification and validation.}
    	\label{table:data}
    	\begin{tabular}{lccc}
    	\hline
    	Input signal & Value (A) & Estimation (s) & Validation (s) \\
    	\hline
    	Uniform white noise & [1.5, 3.6] & [0, 10] & [10, 20] \\
    	Binary random signal with $\alpha = 0.25$ & [1.5, 3.6] & [0, 10] & [10, 20] \\
    	\hline
    	\end{tabular}
    \end{table}
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Models}
\begin{itemize}
    \item descriptions of model structures used. (You should use more than one structure.)
    \item motivation for choice of model order for each model structure.
    \item plots of Bode diagrams, poles and zeros.
    \item analysis/interpretations of plots.
   \item validation performed with simulation (\texttt{compare} with \texttt{M=inf}) and correlation analysis (\texttt{resid}).
   \item analysis/interpretations of validation and correlation analysis.
   \item a comparison between the accuracy of models obtained with different input signals (binary random signals v/s uniformly distributed white noise)
   \item  a ranking of estimated models with respect to how well they describe the process, along with a rigorous motivation of chosen ranking. (Compare the analysis of plots, validation and correlation analysis for the different models.)
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
{\bf Note that the report is not in the format of a conference or journal paper. However, the language should be correct, concise and understandable. The figures should be clear, have captions, labels and be referenced in the text. All equations should be punctuated appropriately. (Equations are considered as part of sentences and should be treated accordingly.) All introduced symbols must be defined.}
\section*{Attachments}
	\label{matlabCode}
    \lstinputlisting{generateBinarySignal.m}
	\lstinputlisting{getAverage.m}
	\lstinputlisting{getStationaryAverages.m}
	\lstinputlisting{findWorkingRegion.m}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
